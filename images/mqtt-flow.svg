<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1012px" preserveAspectRatio="none" style="width:1078px;height:1012px;" version="1.1" viewBox="0 0 1078 1012" width="1078px" zoomAndPan="magnify"><defs><filter height="300%" id="f1aqrmtcl3utjh" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="236" x="420.5" y="22.9951">Typical MQTT Messaging Flow</text><rect fill="#FFFFFF" filter="url(#f1aqrmtcl3utjh)" height="185.7969" style="stroke: #000000; stroke-width: 2.0;" width="681.5" x="333.5" y="380.5234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="27" x2="27" y1="116.5938" y2="924.7813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="145" x2="145" y1="116.5938" y2="924.7813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="280" x2="280" y1="116.5938" y2="924.7813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="414.5" x2="414.5" y1="116.5938" y2="924.7813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="611.5" x2="611.5" y1="116.5938" y2="924.7813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="801.5" x2="801.5" y1="116.5938" y2="924.7813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="961.5" x2="961.5" y1="116.5938" y2="924.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="113.292">User</text><ellipse cx="27" cy="43.2969" fill="#FEFECE" filter="url(#f1aqrmtcl3utjh)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,51.2969 L27,78.2969 M14,59.2969 L40,59.2969 M27,78.2969 L14,93.2969 M27,78.2969 L40,93.2969 " fill="none" filter="url(#f1aqrmtcl3utjh)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="936.7764">User</text><ellipse cx="27" cy="950.0781" fill="#FEFECE" filter="url(#f1aqrmtcl3utjh)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,958.0781 L27,985.0781 M14,966.0781 L40,966.0781 M27,985.0781 L14,1000.0781 M27,985.0781 L40,1000.0781 " fill="none" filter="url(#f1aqrmtcl3utjh)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="93" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="105" y="84.9951">Dashboard</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="100" y="101.292">(mobile app)</text><rect fill="#FEFECE" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="93" y="923.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="105" y="943.7764">Dashboard</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="100" y="960.0732">(mobile app)</text><rect fill="#7FFFD4" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="248" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="257.5" y="84.9951">MQTT</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="255" y="101.292">Broker</text><rect fill="#7FFFD4" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="248" y="923.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="257.5" y="943.7764">MQTT</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="255" y="960.0732">Broker</text><rect fill="#FFC0CB" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="343.5" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="350.5" y="84.9951">MQTT Connection</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="363.5" y="101.292">(virtual device)</text><rect fill="#FFC0CB" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="343.5" y="923.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="350.5" y="943.7764">MQTT Connection</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="363.5" y="960.0732">(virtual device)</text><rect fill="#FFC0CB" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="553.5" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="561" y="84.9951">MQTT Handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="560.5" y="101.292">(virtual device)</text><rect fill="#FFC0CB" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="553.5" y="923.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="561" y="943.7764">MQTT Handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="560.5" y="960.0732">(virtual device)</text><rect fill="#FFC0CB" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="746.5" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="753.5" y="84.9951">Rule Machine</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="757" y="101.292">(built-in app)</text><rect fill="#FFC0CB" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="746.5" y="923.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="753.5" y="943.7764">Rule Machine</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="757" y="960.0732">(built-in app)</text><rect fill="#7FFFD4" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="925.5" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="932.5" y="84.9951">Physical</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="936.5" y="101.292">Device</text><rect fill="#7FFFD4" filter="url(#f1aqrmtcl3utjh)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="69" x="925.5" y="923.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="932.5" y="943.7764">Physical</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="936.5" y="960.0732">Device</text><polygon fill="#A80036" points="133,143.7266,143,147.7266,133,151.7266,137,147.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="139" y1="147.7266" y2="147.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="34" y="142.6606">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="47" y="142.6606">press button</text><path d="M105,160.7266 L105,185.7266 L319,185.7266 L319,170.7266 L309,160.7266 L105,160.7266 " fill="#FBFB77" filter="url(#f1aqrmtcl3utjh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M309,160.7266 L309,170.7266 L319,170.7266 L309,160.7266 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="157" y="177.7935">LAN or internet</text><polygon fill="#A80036" points="268,211.9922,278,215.9922,268,219.9922,272,215.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="145" x2="274" y1="215.9922" y2="215.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="152" y="210.9263">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="165" y="210.9263">MQTT message</text><path d="M230,228.9922 L230,253.9922 L463,253.9922 L463,238.9922 L453,228.9922 L230,228.9922 " fill="#FBFB77" filter="url(#f1aqrmtcl3utjh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M453,228.9922 L453,238.9922 L463,238.9922 L453,228.9922 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="327.25" y="246.0591">LAN</text><polygon fill="#A80036" points="403,280.2578,413,284.2578,403,288.2578,407,284.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280" x2="409" y1="284.2578" y2="284.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="287" y="279.1919">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="300" y="279.1919">MQTT message</text><path d="M354,297.2578 L354,322.2578 L863,322.2578 L863,307.2578 L853,297.2578 L354,297.2578 " fill="#FBFB77" filter="url(#f1aqrmtcl3utjh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M853,297.2578 L853,307.2578 L863,307.2578 L853,297.2578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="578.5" y="314.3247">Hubitat</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="415" x2="457" y1="352.5234" y2="352.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="457" x2="457" y1="352.5234" y2="365.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="416" x2="457" y1="365.5234" y2="365.5234"/><polygon fill="#A80036" points="426,361.5234,416,365.5234,426,369.5234,422,365.5234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="422" y="347.4575">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="435" y="347.4575">find handler for MQTT topic</text><path d="M333.5,380.5234 L403.5,380.5234 L403.5,387.5234 L393.5,397.5234 L333.5,397.5234 L333.5,380.5234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="185.7969" style="stroke: #000000; stroke-width: 2.0;" width="681.5" x="333.5" y="380.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="348.5" y="393.5903">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="418.5" y="392.7339">[handler found]</text><polygon fill="#A80036" points="600,414.7891,610,418.7891,600,422.7891,604,418.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="415" x2="606" y1="418.7891" y2="418.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="422" y="413.7231">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="435" y="413.7231">send event</text><polygon fill="#A80036" points="790,443.9219,800,447.9219,790,451.9219,794,447.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="612" x2="796" y1="447.9219" y2="447.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="619" y="442.856">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="632" y="442.856">custom attribute trigger</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="802" x2="844" y1="477.0547" y2="477.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="844" y1="477.0547" y2="490.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="803" x2="844" y1="490.0547" y2="490.0547"/><polygon fill="#A80036" points="813,486.0547,803,490.0547,813,494.0547,809,490.0547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="471.9888">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="822" y="471.9888">evaluate conditions</text><path d="M758,503.0547 L758,528.0547 L1005,528.0547 L1005,513.0547 L995,503.0547 L758,503.0547 " fill="#FBFB77" filter="url(#f1aqrmtcl3utjh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M995,503.0547 L995,513.0547 L1005,513.0547 L995,503.0547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="812" y="520.1216">z-wave, zigbee, wi-fi</text><polygon fill="#A80036" points="950,554.3203,960,558.3203,950,562.3203,954,558.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="802" x2="956" y1="558.3203" y2="558.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="809" y="553.2544">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="822" y="553.2544">device action</text><path d="M854,578.3203 L854,633.3203 L1065,633.3203 L1065,588.3203 L1055,578.3203 L854,578.3203 " fill="#FBFB77" filter="url(#f1aqrmtcl3utjh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1055,578.3203 L1055,588.3203 L1065,588.3203 L1055,578.3203 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="860" y="595.3872">the flow is identical from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="860" y="610.52">here on no matter the reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="860" y="625.6528">for the state change</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="962" x2="1004" y1="663.8516" y2="663.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1004" x2="1004" y1="663.8516" y2="676.8516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="963" x2="1004" y1="676.8516" y2="676.8516"/><polygon fill="#A80036" points="973,672.8516,963,676.8516,973,680.8516,969,676.8516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="969" y="658.7856">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="982" y="658.7856">change state</text><polygon fill="#A80036" points="813,701.9844,803,705.9844,813,709.9844,809,705.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="807" x2="961" y1="705.9844" y2="705.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="819" y="700.9185">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="841" y="700.9185">trigger</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="802" x2="844" y1="735.1172" y2="735.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="844" x2="844" y1="735.1172" y2="748.1172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="803" x2="844" y1="748.1172" y2="748.1172"/><polygon fill="#A80036" points="813,744.1172,803,748.1172,813,752.1172,809,748.1172" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="809" y="730.0513">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="831" y="730.0513">evaluate conditions</text><polygon fill="#A80036" points="426,773.25,416,777.25,426,781.25,422,777.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="420" x2="801" y1="777.25" y2="777.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="432" y="772.1841">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="454" y="772.1841">publish</text><polygon fill="#A80036" points="291,802.3828,281,806.3828,291,810.3828,287,806.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285" x2="414" y1="806.3828" y2="806.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="297" y="801.3169">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="319" y="801.3169">MQTT</text><polygon fill="#A80036" points="156,831.5156,146,835.5156,156,839.5156,152,835.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="150" x2="279" y1="835.5156" y2="835.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="162" y="830.4497">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="184" y="830.4497">MQTT</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="145" x2="187" y1="864.6484" y2="864.6484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187" x2="187" y1="864.6484" y2="877.6484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="146" x2="187" y1="877.6484" y2="877.6484"/><polygon fill="#A80036" points="156,873.6484,146,877.6484,156,881.6484,152,877.6484" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="152" y="859.5825">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="174" y="859.5825">update display</text><polygon fill="#A80036" points="38,902.7813,28,906.7813,38,910.7813,34,906.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="32" x2="144" y1="906.7813" y2="906.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="44" y="901.7153">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="66" y="901.7153">view</text><!--MD5=[e19af5b793c3a1b3a215e36861bc94dd]
@startuml

autonumber

title Typical MQTT Messaging Flow

actor "User" as user
participant "Dashboard\n(mobile app)" as dashboard
participant "MQTT\nBroker" as broker #aquamarine
participant "MQTT Connection\n(virtual device)" as connection #pink
participant "MQTT Handler\n(virtual device)" as handler #pink
participant "Rule Machine\n(built-in app)" as rm #pink
participant "Physical\nDevice" as device #aquamarine

user -> dashboard: press button

note over dashboard, broker
LAN or internet
end note

dashboard -> broker: MQTT message

note over broker, connection
LAN
end note

broker -> connection: MQTT message

note over connection, rm
Hubitat
end note

connection -> connection: find handler for MQTT topic

opt handler found
  connection -> handler: send event
  handler -> rm: custom attribute trigger
  rm -> rm: evaluate conditions

  note over rm, device
  z-wave, zigbee, wi-fi
  end note

  rm -> device: device action
end

note over device
the flow is identical from
here on no matter the reason
for the state change
end note

device -> device: change state
device -> rm: trigger
rm -> rm: evaluate conditions
rm -> connection: publish
connection -> broker: MQTT
broker -> dashboard: MQTT
dashboard -> dashboard: update display
dashboard -> user: view

@enduml

PlantUML version 1.2019.11(Sun Sep 22 03:02:15 PDT 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_232-ea-8u232-b09-0ubuntu1-b09
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>